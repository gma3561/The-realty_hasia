<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê³µìœ ì—¬ë¶€ í‘œì‹œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f4f4f4;
            font-weight: bold;
        }
        .shared-true {
            background: #e8f5e9;
            color: #2e7d32;
            font-weight: bold;
        }
        .shared-false {
            background: #fce4ec;
            color: #c2185b;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            margin: 20px 0;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ê³µìœ ì—¬ë¶€ í‘œì‹œ í…ŒìŠ¤íŠ¸</h1>
    
    <div id="log" class="log">í…ŒìŠ¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
    
    <h2>ìµœê·¼ ë§¤ë¬¼ ë°ì´í„° (ê³µìœ ì—¬ë¶€ í™•ì¸)</h2>
    <table id="propertyTable">
        <thead>
            <tr>
                <th>ë§¤ë¬¼ëª…</th>
                <th>ê³µìœ ì—¬ë¶€ (DBê°’)</th>
                <th>í‘œì‹œê°’</th>
                <th>ë‹´ë‹¹ì</th>
                <th>ìƒíƒœ</th>
                <th>ë“±ë¡ì¼</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="6">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
        </tbody>
    </table>

    <h2>ê³µìœ /ë¹„ê³µìœ  í†µê³„</h2>
    <div id="stats"></div>

    <!-- Supabase ì„¤ì • -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script>
        const log = (message) => {
            const logDiv = document.getElementById('log');
            logDiv.textContent += message + '\n';
            console.log(message);
        };

        async function testSharedDisplay() {
            log('=== ê³µìœ ì—¬ë¶€ í‘œì‹œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            if (!window.supabaseClient) {
                log('âŒ Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                // ìµœê·¼ ë°ì´í„° 50ê°œ ê°€ì ¸ì˜¤ê¸°
                log('ğŸ“¥ ìµœê·¼ 50ê°œ ë°ì´í„° ì¡°íšŒ ì¤‘...');
                const { data: properties, error } = await window.supabaseClient
                    .from('properties')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (error) {
                    log('âŒ ì˜¤ë¥˜: ' + error.message);
                    return;
                }

                log(`âœ… ${properties.length}ê°œ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ`);

                // í†µê³„ ê³„ì‚°
                let sharedTrue = 0;
                let sharedFalse = 0;
                let sharedNull = 0;

                const tableBody = document.getElementById('tableBody');
                let html = '';

                properties.forEach(property => {
                    // ê³µìœ ì—¬ë¶€ ê°’ ë¶„ì„
                    const sharedValue = property.shared;
                    let displayValue = '';
                    let className = '';

                    if (sharedValue === true) {
                        displayValue = 'ê³µìœ ';
                        className = 'shared-true';
                        sharedTrue++;
                    } else if (sharedValue === false) {
                        displayValue = 'ë¹„ê³µìœ ';
                        className = 'shared-false';
                        sharedFalse++;
                    } else if (sharedValue === null || sharedValue === undefined) {
                        displayValue = 'ë¯¸ì„¤ì •';
                        className = '';
                        sharedNull++;
                    } else {
                        displayValue = `ê¸°íƒ€: ${sharedValue}`;
                        className = '';
                    }

                    html += `
                        <tr>
                            <td>${property.property_name || '-'}</td>
                            <td>${sharedValue === null ? 'null' : sharedValue === undefined ? 'undefined' : sharedValue}</td>
                            <td class="${className}">${displayValue}</td>
                            <td>${property.manager || '-'}</td>
                            <td>${property.status || '-'}</td>
                            <td>${property.register_date ? new Date(property.register_date).toLocaleDateString('ko-KR') : '-'}</td>
                        </tr>
                    `;
                });

                tableBody.innerHTML = html;

                // í†µê³„ í‘œì‹œ
                const statsDiv = document.getElementById('stats');
                statsDiv.innerHTML = `
                    <p><strong>ì „ì²´: ${properties.length}ê°œ</strong></p>
                    <p style="color: #2e7d32;">âœ… ê³µìœ  (true): ${sharedTrue}ê°œ (${(sharedTrue/properties.length*100).toFixed(1)}%)</p>
                    <p style="color: #c2185b;">âŒ ë¹„ê³µìœ  (false): ${sharedFalse}ê°œ (${(sharedFalse/properties.length*100).toFixed(1)}%)</p>
                    <p style="color: #666;">âšª ë¯¸ì„¤ì • (null/undefined): ${sharedNull}ê°œ (${(sharedNull/properties.length*100).toFixed(1)}%)</p>
                `;

                log('\n=== í†µê³„ ===');
                log(`ê³µìœ : ${sharedTrue}ê°œ`);
                log(`ë¹„ê³µìœ : ${sharedFalse}ê°œ`);
                log(`ë¯¸ì„¤ì •: ${sharedNull}ê°œ`);

                // ë¬¸ì œ ì§„ë‹¨
                if (sharedNull > 0) {
                    log('\nâš ï¸ ì¼ë¶€ ë°ì´í„°ì˜ ê³µìœ ì—¬ë¶€ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }

                if (sharedTrue === 0 && sharedFalse === 0) {
                    log('\nâŒ ëª¨ë“  ë°ì´í„°ì˜ ê³µìœ ì—¬ë¶€ê°€ ë¯¸ì„¤ì • ìƒíƒœì…ë‹ˆë‹¤.');
                    log('ì›ì¸: CSV ì—…ë¡œë“œ ì‹œ ê³µìœ ì—¬ë¶€ í•„ë“œê°€ ì œëŒ€ë¡œ ë§¤í•‘ë˜ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±');
                }

                log('\nâœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ');

            } catch (error) {
                log('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(testSharedDisplay, 1000);
        });
    </script>
</body>
</html>