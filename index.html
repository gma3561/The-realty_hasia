<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>더부동산 임시매물정</title>
    
    <!-- PWA 메타 태그 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="더부동산">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="slack-button-styles.css">
    <link rel="stylesheet" href="no-select-styles.css">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Supabase 설정 -->
    <script src="supabase-config.js"></script>
    <!-- 슬랙 설정 -->
    <script src="slack-config.js"></script>
    
    <script>
        // 첫 방문 시 스플래시 스크린 표시
        if (!sessionStorage.getItem('splashShown')) {
            sessionStorage.setItem('splashShown', 'true');
            window.location.href = 'splash-screen.html';
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="btn-spacer"></div>
            <svg width="240" height="45" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 45" class="logo">
                <!-- 배경 -->
                <rect width="240" height="45" fill="black" rx="4"/>
                <!-- SINCE 1999 -->
                <text x="10" y="20" font-size="11" font-family="sans-serif" fill="white" letter-spacing="1">SINCE 1999</text>
                
                <!-- 더부동산중개법인 -->
                <text x="10" y="38" font-size="20" font-family="sans-serif" fill="white">더부동산중개법인</text>
            </svg>
            <div class="header-title" onclick="handleHeaderClick()">팀매물장</div>
        </div>

        <div class="filter-bar">
            <div class="filter-left">
                <input type="text" class="search-input" placeholder="주소 또는 매물명으로 검색하세요" onkeyup="searchProperties(event)">
            </div>
            <div class="filter-right">
                <button class="reset-btn" onclick="resetFilters()">초기화</button>
                <button class="sort-btn" onclick="toggleSort()">정렬 <span class="sort-arrow">↓</span></button>
                <button id="adminLogoutBtn" class="reset-btn" onclick="adminLogout()" style="display: none;">관리자 로그아웃</button>
                <button class="btn-primary" onclick="goToForm()">매물등록</button>
            </div>
        </div>

        <div class="table-container">
            <table class="data-table" id="dataTable">
                <thead>
                    <tr>
                        <th class="sortable">등록일 <span class="sort-arrow">↓</span></th>
                        <th>매물번호</th>
                        <th class="filterable" onclick="showFilterMenu(event, 'status')">
                            매물상태
                            <span class="filter-icon">↓</span>
                        </th>
                        <th class="filterable" onclick="showFilterMenu(event, 'type')">
                            매물종류
                            <span class="filter-icon">↓</span>
                        </th>
                        <th class="filterable" onclick="showFilterMenu(event, 'trade')">
                            거래유형
                            <span class="filter-icon">↓</span>
                        </th>
                        <th>금액</th>
                        <th>매물명</th>
                        <th>소재지</th>
                        <th>동</th>
                        <th>호</th>
                        <th>공급/전용 (㎡)</th>
                        <th>공급/전용 (평)</th>
                        <th>해당층/총층</th>
                        <th>공유여부</th>
                        <th>담당자</th>
                        <th class="admin-only" style="display: none;">소유자명</th>
                        <th class="admin-only" style="display: none;">소유자연락처</th>
                        <th class="admin-only" style="display: none;">연락처관계</th>
                        <th class="admin-only" style="display: none;">특이사항</th>
                        <th class="admin-only" style="display: none;">담당자MEMO</th>
                        <th id="adminColumn" style="display: none;">수정/삭제</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
        
        <!-- 페이지네이션 -->
        <div class="pagination-container">
            <div class="pagination-info">
                <span id="paginationInfo">전체 0건</span>
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" id="prevBtn" onclick="changePage(-1)">
                    <span class="desktop-text">이전</span>
                    <svg class="mobile-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </button>
                <div class="pagination-numbers" id="paginationNumbers"></div>
                <button class="pagination-btn" id="nextBtn" onclick="changePage(1)">
                    <span class="desktop-text">다음</span>
                    <svg class="mobile-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 사이드 패널 상세 뷰 (데스크톱용) -->
    <div id="sidePanel" class="side-panel">
        <div class="side-panel-header" style="background: black; color: white; padding: 12px 20px; display: flex; align-items: center; justify-content: flex-end; margin: -20px -20px 20px -20px;">
            <button class="close-panel" onclick="closeSidePanel()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
        </div>
        
        <div class="side-panel-content">
            <!-- 매물명을 큰 제목으로 -->
            <div class="property-title-section">
                <h2 id="sidePropertyTitle">롯데캐슬이스트폴 (136A타입)</h2>
            </div>

            <!-- 핵심 정보 -->
            <div class="property-detail-grid">
                <div class="detail-item">
                    <label>금액</label>
                    <span id="sidePrice">1,050</span>
                </div>
                <div class="detail-item">
                    <label>거래유형</label>
                    <span id="sideTrade">렌트</span>
                </div>
                <div class="detail-item">
                    <label>매물상태</label>
                    <span id="sideStatus">거래완료</span>
                </div>
                <div class="detail-item">
                    <label>담당자</label>
                    <span id="sideManager">박소희</span>
                </div>
                <div class="detail-item">
                    <label>등록일</label>
                    <span id="sideRegisterDate">2025-08-15</span>
                </div>
            </div>

            <!-- 기본 정보 섹션 -->
            <div class="section-title">기본 정보</div>
            <div class="property-detail-grid">
                <div class="detail-item">
                    <label>매물종류</label>
                    <span id="sideType">아파트</span>
                </div>
                <div class="detail-item">
                    <label>공유여부</label>
                    <span id="sideShared">-</span>
                </div>
                <div class="detail-item">
                    <label>재등록사유</label>
                    <span id="sideReason">-</span>
                </div>
            </div>

            <!-- 위치 및 구조 섹션 -->
            <div class="section-title">위치 및 구조</div>
            <div class="property-detail-grid">
                <div class="detail-item">
                    <label>동</label>
                    <span id="sideDong">-</span>
                </div>
                <div class="detail-item">
                    <label>호</label>
                    <span id="sideUnit">-</span>
                </div>
                <div class="detail-item">
                    <label>소재지</label>
                    <span id="sideAddress">-</span>
                </div>
                <div class="detail-item">
                    <label>방향</label>
                    <span id="sideDirection">-</span>
                </div>
                <div class="detail-item">
                    <label>룸/욕실</label>
                    <span id="sideRooms">-</span>
                </div>
                <div class="detail-item">
                    <label>해당층/총층</label>
                    <span id="sideFloorInfo">-</span>
                </div>
            </div>

            <!-- 거래 정보 섹션 -->
            <div class="section-title">거래 정보</div>
            <div class="property-detail-grid">
                <div class="detail-item">
                    <label>계약기간</label>
                    <span id="sideContractPeriod">-</span>
                </div>
                <div class="detail-item">
                    <label>거래완료날짜</label>
                    <span id="sideCompletionDate">-</span>
                </div>
            </div>

            <!-- 면적 정보 섹션 -->
            <div class="section-title">면적 정보</div>
            <div class="property-detail-grid">
                <div class="detail-item">
                    <label>공급/전용 (㎡)</label>
                    <span id="sideSupplyArea">-</span>
                </div>
                <div class="detail-item">
                    <label>공급/전용 (평)</label>
                    <span id="sideSupplyPyeong">-</span>
                </div>
            </div>

            <!-- 관리자 전용: 소유자 정보 섹션 -->
            <div class="admin-only-section" style="display: none;">
                <div class="section-title">소유자 정보 (관리자 전용)</div>
                <div class="property-detail-grid">
                    <div class="detail-item">
                        <label>소유자명</label>
                        <span id="sideOwnerName">-</span>
                    </div>
                    <div class="detail-item">
                        <label>소유자연락처</label>
                        <span id="sideOwnerContact">-</span>
                    </div>
                    <div class="detail-item">
                        <label>연락처관계</label>
                        <span id="sideContactRelation">-</span>
                    </div>
                    <div class="detail-item">
                        <label>입주가능일</label>
                        <span id="sideMoveInDate">-</span>
                    </div>
                    <div class="detail-item">
                        <label>사용승인일</label>
                        <span id="sideApprovalDate">-</span>
                    </div>
                    <div class="detail-item">
                        <label>관리비</label>
                        <span id="sideManagement">-</span>
                    </div>
                    <div class="detail-item">
                        <label>주차</label>
                        <span id="sideParking">-</span>
                    </div>
                    <div class="detail-item">
                        <label>방향</label>
                        <span id="sideDirectionDetail">-</span>
                    </div>
                </div>
            </div>

            <!-- 담당자MEMO 섹션 -->
            <div class="section-title">담당자MEMO</div>
            <div class="memo-text" id="sideMemoText">-</div>

            <!-- 특이사항 섹션 -->
            <div class="section-title">특이사항</div>
            <div class="special-text" id="sideSpecialText">-</div>
        </div>
        
        <!-- 하단 슬랙 전송 버튼 (데스크톱) -->
        <div class="side-panel-bottom-actions">
            <button class="slack-send-btn" onclick="handleSlackButtonClick()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313z"/>
                    <path d="M8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312z"/>
                    <path d="M18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312z"/>
                    <path d="M15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
                </svg>
                슬랙으로 전송
            </button>
        </div>
    </div>

    <!-- 모바일용 모달 (기존 모달을 모바일에서만 사용) -->
    <div id="detailModal" class="modal mobile-only">
        <div class="modal-content">
            <div class="modal-header" style="background: black; color: white; padding: 30px 20px 10px 20px; margin: 0 -20px 20px -20px; border-radius: 12px 12px 0 0; min-height: 60px; padding-top: env(safe-area-inset-top, 30px);">
                <div style="display: flex; align-items: center; justify-content: flex-end; position: relative; width: 100%; height: 100%;">
                    <span class="close" style="color: white; font-size: 26px; cursor: pointer;">&times;</span>
                </div>
            </div>
            <div class="modal-body">
                <div class="mobile-property-details">
                    <!-- 핵심 정보 섹션 (모바일) -->
                    <div class="mobile-detail-grid">
                        <div class="mobile-detail-item">
                            <span class="mobile-label">매물명:</span>
                            <span id="mobileProperty">-</span>
                        </div>
                        <div class="mobile-detail-item">
                            <span class="mobile-label">금액:</span>
                            <span id="mobilePrice">-</span>
                        </div>
                        <div class="mobile-detail-item">
                            <span class="mobile-label">거래유형:</span>
                            <span id="mobileTrade">-</span>
                        </div>
                        <div class="mobile-detail-item">
                            <span class="mobile-label">매물상태:</span>
                            <span id="mobileStatus">-</span>
                        </div>
                        <div class="mobile-detail-item">
                            <span class="mobile-label">담당자:</span>
                            <span id="mobileManager">-</span>
                        </div>
                        <div class="mobile-detail-item">
                            <span class="mobile-label">등록일:</span>
                            <span id="mobileRegisterDate">-</span>
                        </div>
                    </div>

                    <div class="mobile-detail-section">
                        <h3>기본 정보</h3>
                        <div class="mobile-detail-grid">
                            <div class="mobile-detail-item">
                                <span class="mobile-label">매물종류:</span>
                                <span id="mobileType">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">공유여부:</span>
                                <span id="mobileShared">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">재등록사유:</span>
                                <span id="mobileReason">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="mobile-detail-section">
                        <h3>위치 및 구조</h3>
                        <div class="mobile-detail-grid">
                            <div class="mobile-detail-item">
                                <span class="mobile-label">동:</span>
                                <span id="mobileDong">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">호:</span>
                                <span id="mobileUnit">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">소재지:</span>
                                <span id="mobileAddress">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">방향:</span>
                                <span id="mobileDirection">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">룸/욕실:</span>
                                <span id="mobileRooms">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">해당층/총층:</span>
                                <span id="mobileFloorInfo">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="mobile-detail-section">
                        <h3>거래 정보</h3>
                        <div class="mobile-detail-grid">
                            <div class="mobile-detail-item">
                                <span class="mobile-label">계약기간:</span>
                                <span id="mobileContractPeriod">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">거래완료날짜:</span>
                                <span id="mobileCompletionDate">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="mobile-detail-section">
                        <h3>면적 정보</h3>
                        <div class="mobile-detail-grid">
                            <div class="mobile-detail-item">
                                <span class="mobile-label">공급/전용 (㎡):</span>
                                <span id="mobileSupplyArea">-</span>
                            </div>
                            <div class="mobile-detail-item">
                                <span class="mobile-label">공급/전용 (평):</span>
                                <span id="mobileSupplyPyeong">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- 관리자 전용: 소유자 정보 섹션 (모바일) -->
                    <div class="mobile-admin-only-section" style="display: none;">
                        <div class="mobile-detail-section">
                            <h3>소유자 정보 (관리자 전용)</h3>
                            <div class="mobile-detail-grid">
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">소유자명:</span>
                                    <span id="mobileOwnerName">-</span>
                                </div>
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">소유자연락처:</span>
                                    <span id="mobileOwnerContact">-</span>
                                </div>
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">연락처관계:</span>
                                    <span id="mobileContactRelation">-</span>
                                </div>
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">입주가능일:</span>
                                    <span id="mobileMoveInDate">-</span>
                                </div>
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">사용승인일:</span>
                                    <span id="mobileApprovalDate">-</span>
                                </div>
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">관리비:</span>
                                    <span id="mobileManagement">-</span>
                                </div>
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">주차:</span>
                                    <span id="mobileParking">-</span>
                                </div>
                                <div class="mobile-detail-item">
                                    <span class="mobile-label">방향:</span>
                                    <span id="mobileDirectionDetail">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MEMO 및 특이사항 -->
                    <div class="mobile-detail-section">
                        <h3>담당자MEMO</h3>
                        <div class="mobile-memo-content" id="mobileMemo">
                            등록된 메모가 없습니다.
                        </div>
                    </div>

                    <div class="mobile-detail-section">
                        <h3>특이사항</h3>
                        <div class="mobile-special-content" id="mobileSpecial">
                            등록된 특이사항이 없습니다.
                        </div>
                    </div>
                </div>

                <!-- 하단 슬랙 전송 버튼 (모바일) -->
                <div class="mobile-slack-section">
                    <button class="mobile-slack-btn" onclick="handleSlackButtonClick()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313z"/>
                            <path d="M8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312z"/>
                            <path d="M18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312z"/>
                            <path d="M15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
                        </svg>
                        슬랙으로 전송
                    </button>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="closeModal()">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 배경 오버레이 -->
    <div id="overlay" class="overlay"></div>

    <!-- 필터 메뉴 -->
    <div id="filterMenu" class="filter-menu">
        <div class="filter-menu-header">
            <span class="filter-menu-title">필터</span>
            <button class="filter-menu-close" onclick="closeFilterMenu()">×</button>
        </div>
        <div class="filter-menu-body">
            <div class="filter-menu-search">
                <input type="text" id="filterSearchInput" placeholder="검색..." onkeyup="filterMenuSearch(event)">
            </div>
            <div class="filter-menu-options" id="filterMenuOptions">
                <!-- 옵션들이 동적으로 추가됨 -->
            </div>
        </div>
        <div class="filter-menu-footer">
            <button class="filter-menu-btn" onclick="clearFilter()">초기화</button>
            <button class="filter-menu-btn primary" onclick="applyFilter()">적용</button>
        </div>
    </div>

    <script src="copy-protection.js"></script>
    <script src="script.js"></script>
    <script src="slack-float-button.js"></script>
    
    <!-- PWA Service Worker 등록 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/The-realty_hasia/service-worker.js')
                    .then(registration => console.log('ServiceWorker 등록 성공:', registration.scope))
                    .catch(error => console.log('ServiceWorker 등록 실패:', error));
            });
        }
        
        // PWA 설치 프롬프트
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // 설치 버튼 표시 (필요시 구현)
        });
    </script>
</body>
</html>