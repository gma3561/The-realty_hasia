<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>더부동산 매물등록</title>
    
    <!-- PWA 메타 태그 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="더부동산">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="form-styles.css">
    <link rel="stylesheet" href="confirm-modal-styles.css">
    <link rel="stylesheet" href="no-select-styles.css">
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Supabase 설정 -->
    <script src="supabase-config.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="btn-back" onclick="confirmGoBack()" title="목록으로">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <svg width="240" height="45" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 45" class="logo">
                <!-- 배경 -->
                <rect width="240" height="45" fill="black" rx="4"/>
                <!-- SINCE 1999 -->
                <text x="10" y="20" font-size="11" font-family="sans-serif" fill="white" letter-spacing="1">SINCE 1999</text>
                
                <!-- 더부동산중개법인 -->
                <text x="10" y="38" font-size="20" font-family="sans-serif" fill="white">더부동산중개법인</text>
            </svg>
            <div class="page-title">매물등록</div>
        </div>

        <div class="form-container">
            <form id="propertyForm">
                <div class="form-grid">
                    <!-- 첫 번째 행 -->
                    <div class="form-group">
                        <label for="registerDate">등록일</label>
                        <input type="date" id="registerDate" name="registerDate" required readonly style="background-color: #f3f4f6; cursor: not-allowed;">
                    </div>
                    <div class="form-group manager-shared-group" style="grid-column: span 2;">
                        <div style="display: flex; gap: 20px; width: 100%;">
                            <div style="flex: 1;">
                                <label for="manager">담당자</label>
                                <select id="manager" name="manager" style="width: 100%;">
                                    <option value="">선택하세요</option>
                                    <option value="김규민">김규민</option>
                                    <option value="하상현">하상현</option>
                                    <option value="정서연">정서연</option>
                                    <option value="정선혜">정선혜</option>
                                    <option value="박소현">박소현</option>
                                    <option value="정연서">정연서</option>
                                    <option value="송영주">송영주</option>
                                    <option value="정윤식">정윤식</option>
                                    <option value="성은미">성은미</option>
                                    <option value="서을선">서을선</option>
                                    <option value="서지혜">서지혜</option>
                                    <option value="김효석">김효석</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px; padding-top: 26px;">
                                <label for="shared" style="margin: 0;">공유여부</label>
                                <input type="checkbox" id="shared" name="shared" style="width: 18px; height: 18px; margin: 0;">
                            </div>
                        </div>
                    </div>

                    <!-- 두 번째 행 - 매물상태, 매물종류, 거래유형 -->
                    <div class="form-group">
                        <label for="status">매물상태</label>
                        <select id="status" name="status">
                            <option value="">선택하세요</option>
                            <option value="거래가능">거래가능</option>
                            <option value="거래완료">거래완료</option>
                            <option value="거래보류">거래보류</option>
                            <option value="거래철회">거래철회</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propertyType">매물종류</label>
                        <select id="propertyType" name="propertyType">
                            <option value="">선택하세요</option>
                            <option value="아파트">아파트</option>
                            <option value="주상복합">주상복합</option>
                            <option value="빌라/연립">빌라/연립</option>
                            <option value="오피스텔">오피스텔</option>
                            <option value="단독주택">단독주택</option>
                            <option value="타운하우스">타운하우스</option>
                            <option value="빌딩/건물">빌딩/건물</option>
                            <option value="사무실/상가">사무실/상가</option>
                            <option value="상가주택">상가주택</option>
                            <option value="원룸">원룸</option>
                            <option value="다가구">다가구</option>
                            <option value="한옥">한옥</option>
                            <option value="숙박/콘도">숙박/콘도</option>
                            <option value="전원/농가">전원/농가</option>
                            <option value="공장/창고">공장/창고</option>
                            <option value="재개발">재개발</option>
                            <option value="재건축">재건축</option>
                            <option value="아파트분양권">아파트분양권</option>
                            <option value="주상복합분양권">주상복합분양권</option>
                            <option value="오피스텔분양권">오피스텔분양권</option>
                            <option value="지식산업센터">지식산업센터</option>
                            <option value="기타">기타</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tradeType">거래유형</label>
                        <select id="tradeType" name="tradeType">
                            <option value="">선택하세요</option>
                            <option value="분양">분양</option>
                            <option value="매매">매매</option>
                            <option value="전세">전세</option>
                            <option value="월세/렌트">월세/렌트</option>
                            <option value="단기">단기</option>
                        </select>
                    </div>

                    <!-- 세 번째 행 - 매물명, 소재지, 동, 호 연속 배치 -->
                    <div class="form-group">
                        <label for="propertyName">매물명</label>
                        <input type="text" id="propertyName" name="propertyName" placeholder="매물명을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="address">소재지</label>
                        <input type="text" id="address" name="address" placeholder="주소를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="dong">동</label>
                        <input type="text" id="dong" name="dong" placeholder="동을 입력하세요">
                    </div>

                    <!-- 네 번째 행 -->
                    <div class="form-group">
                        <label for="unit">호</label>
                        <input type="text" id="unit" name="unit" placeholder="호수를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="reRegisterReason">재등록사유</label>
                        <input type="text" id="reRegisterReason" name="reRegisterReason" placeholder="재등록사유를 입력하세요">
                    </div>

                    <!-- 다섯 번째 행 -->
                    <div class="form-group">
                        <label for="price">금액</label>
                        <input type="text" id="price" name="price" placeholder="가격을 입력하세요">
                    </div>

                    <!-- 여섯 번째 행 -->
                    <div class="form-group">
                        <label for="supplyArea">공급/전용 (㎡)</label>
                        <input type="text" id="supplyArea" name="supplyArea" placeholder="공급면적/전용면적 (㎡)">
                    </div>
                    <div class="form-group">
                        <label for="supplyPyeong">공급/전용 (평)</label>
                        <input type="text" id="supplyPyeong" name="supplyPyeong" placeholder="공급면적/전용면적 (평)">
                    </div>

                    <!-- 일곱 번째 행 -->
                    <div class="form-group">
                        <label for="floorInfo">해당층/총층</label>
                        <input type="text" id="floorInfo" name="floorInfo" placeholder="예: 15/25">
                    </div>
                    <div class="form-group">
                        <label for="rooms">룸/욕실</label>
                        <input type="text" id="rooms" name="rooms" placeholder="룸수/욕실수">
                    </div>
                    <div class="form-group">
                        <label for="direction">방향(거실기준)</label>
                        <input type="text" id="direction" name="direction" placeholder="방향을 입력하세요">
                    </div>

                    <!-- 여덟 번째 행 -->
                    <div class="form-group">
                        <label for="management">관리비</label>
                        <input type="text" id="management" name="management" placeholder="관리비를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="parking">주차</label>
                        <input type="text" id="parking" name="parking" placeholder="주차 정보를 입력하세요">
                    </div>

                    <!-- 아홉 번째 행 -->
                    <div class="form-group">
                        <label for="moveInDate">입주가능일</label>
                        <input type="date" id="moveInDate" name="moveInDate">
                    </div>
                    <div class="form-group">
                        <label for="approvalDate">사용승인</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="date" id="approvalDate" name="approvalDate" style="flex: 1;">
                            <div style="display: flex; gap: 4px;">
                                <button type="button" class="year-btn" onclick="adjustApprovalYear(-5)">-5년</button>
                                <button type="button" class="year-btn" onclick="adjustApprovalYear(-1)">-1년</button>
                                <button type="button" class="year-btn" onclick="adjustApprovalYear(1)">+1년</button>
                                <button type="button" class="year-btn" onclick="adjustApprovalYear(5)">+5년</button>
                            </div>
                        </div>
                    </div>

                    <!-- 열 번째 행 - 특이사항 (전체 너비) -->
                    <div class="form-group full-width">
                        <label for="specialNotes">특이사항</label>
                        <textarea id="specialNotes" name="specialNotes" rows="4" placeholder="특이사항을 입력하세요"></textarea>
                    </div>

                    <!-- 담당자 메모 -->
                    <div class="form-group full-width">
                        <label for="managerMemo">담당자 MEMO</label>
                        <textarea id="managerMemo" name="managerMemo" rows="3" placeholder="담당자 메모를 입력하세요"></textarea>
                    </div>

                    <!-- 소유자 정보 섹션 -->
                    <div class="form-group full-width">
                        <h3 style="margin: 20px 0 10px 0; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb; font-size: 16px; color: #374151;">소유자 정보</h3>
                    </div>
                    <div class="form-group">
                        <label for="owner">소유자</label>
                        <input type="text" id="owner" name="owner" placeholder="소유자명을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="ownerId">주민(법인)등록번호</label>
                        <input type="text" id="ownerId" name="ownerId" placeholder="주민등록번호 또는 법인등록번호">
                    </div>
                    <div class="form-group">
                        <label for="ownerContact">소유주 연락처</label>
                        <input type="tel" id="ownerContact" name="ownerContact" placeholder="연락처를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="contactRelation">연락처 관계</label>
                        <input type="text" id="contactRelation" name="contactRelation" placeholder="본인, 배우자, 자녀 등">
                    </div>

                    <!-- 거래 정보 섹션 -->
                    <div class="form-group full-width">
                        <h3 style="margin: 20px 0 10px 0; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb; font-size: 16px; color: #374151;">거래 정보</h3>
                    </div>
                    <div class="form-group">
                        <label for="completionDate">거래완료날짜</label>
                        <input type="date" id="completionDate" name="completionDate">
                    </div>
                    <div class="form-group">
                        <label for="resident">거주자</label>
                        <input type="text" id="resident" name="resident" placeholder="거주자 정보를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="rentType">임차유형</label>
                        <input type="text" id="rentType" name="rentType" placeholder="임차유형을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="rentAmount">임차금액</label>
                        <input type="text" id="rentAmount" name="rentAmount" placeholder="임차금액을 입력하세요">
                    </div>
                    <div class="form-group">
                        <label for="contractPeriod">계약기간</label>
                        <input type="text" id="contractPeriod" name="contractPeriod" placeholder="예: 2년">
                    </div>

                    <!-- 광고/공동중개 정보 섹션 - 컴팩트 버전 -->
                    <div class="form-group full-width">
                        <h3 style="margin: 20px 0 10px 0; padding-bottom: 6px; border-bottom: 1px solid #e5e7eb; font-size: 14px; color: #6b7280;">광고/공동중개 정보</h3>
                    </div>
                    <div class="form-group compact-checkbox">
                        <label for="photo">사진</label>
                        <input type="checkbox" id="photo" name="photo">
                    </div>
                    <div class="form-group compact-checkbox">
                        <label for="video">영상</label>
                        <input type="checkbox" id="video" name="video">
                    </div>
                    <div class="form-group compact-checkbox">
                        <label for="appearance">출연</label>
                        <input type="checkbox" id="appearance" name="appearance">
                    </div>
                    <div class="form-group">
                        <label for="jointBrokerage" style="font-size: 12px;">공동중개</label>
                        <input type="text" id="jointBrokerage" name="jointBrokerage" placeholder="공동중개 정보" style="font-size: 12px; padding: 6px 10px;">
                    </div>
                    <div class="form-group">
                        <label for="jointContact" style="font-size: 12px;">공동연락처</label>
                        <input type="text" id="jointContact" name="jointContact" placeholder="공동연락처" style="font-size: 12px; padding: 6px 10px;">
                    </div>
                    <div class="form-group">
                        <label for="adStatus" style="font-size: 12px;">광고상태</label>
                        <select id="adStatus" name="adStatus" style="font-size: 12px; padding: 6px 10px;">
                            <option value="">선택하세요</option>
                            <option value="진행중">진행중</option>
                            <option value="종료">종료</option>
                            <option value="예정">예정</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="adPeriod" style="font-size: 12px;">광고기간</label>
                        <input type="text" id="adPeriod" name="adPeriod" placeholder="예: 30일" style="font-size: 12px; padding: 6px 10px;">
                    </div>
                    <div class="form-group">
                        <label for="registrationNumber" style="font-size: 12px;">등록완료번호</label>
                        <input type="text" id="registrationNumber" name="registrationNumber" placeholder="등록완료번호" style="font-size: 12px; padding: 6px 10px;">
                    </div>

                </div>
            </form>
        </div>
        
        <!-- 하단 저장 버튼 -->
        <div class="bottom-actions">
            <button class="btn-save" onclick="confirmSave()">저장하기</button>
        </div>
    </div>

    <!-- 확인 팝업 모달 -->
    <div id="confirmModal" class="confirm-modal" style="display: none;">
        <div class="confirm-modal-overlay"></div>
        <div class="confirm-modal-content">
            <div class="confirm-modal-header">
                <h3 id="confirmTitle">확인</h3>
            </div>
            <div class="confirm-modal-body">
                <p id="confirmMessage">정말로 진행하시겠습니까?</p>
            </div>
            <div class="confirm-modal-actions">
                <button class="btn-cancel" onclick="closeConfirmModal()">취소</button>
                <button class="btn-confirm" id="confirmBtn" onclick="executeConfirmedAction()">확인</button>
            </div>
        </div>
    </div>

    <script>
        let confirmedAction = null;
        
        function showConfirmModal(title, message, action) {
            console.log('showConfirmModal 호출:', title);
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            confirmedAction = action;
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('모달 display 변경: flex');
            } else {
                console.error('confirmModal 요소를 찾을 수 없습니다.');
            }
        }
        
        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
            confirmedAction = null;
        }
        
        function executeConfirmedAction() {
            if (confirmedAction) {
                confirmedAction();
            }
            closeConfirmModal();
        }
        
        function confirmGoBack() {
            // 뒤로가기 기능 비활성화
            alert('뒤로가기는 지원되지 않습니다. 저장 후 자동으로 목록으로 이동됩니다.');
            return false;
        }
        
        function confirmSave() {
            console.log('confirmSave 호출됨');
            console.log('saveProperty 타입:', typeof window.saveProperty);
            
            if (typeof window.saveProperty !== 'function') {
                console.error('saveProperty 함수가 정의되지 않았습니다.');
                alert('페이지 로딩이 완료되지 않았습니다. 잠시 후 다시 시도해주세요.');
                return;
            }
            
            showConfirmModal(
                '매물 저장', 
                '매물 정보를 저장하시겠습니까?', 
                window.saveProperty
            );
        }
        
        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeConfirmModal();
            }
        });
        
        // 오버레이 클릭으로 모달 닫기
        document.querySelector('.confirm-modal-overlay')?.addEventListener('click', closeConfirmModal);
    </script>
    
    <!-- 복사 방지 -->
    <script src="copy-protection.js"></script>
    <!-- 폼 스크립트 -->
    <script src="form-script-supabase.js"></script>
</body>
</html>