<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ì • ê¸°ëŠ¥ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: black;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-left: 3px solid #007bff;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            border-left-color: #dc3545;
            color: #dc3545;
        }
        .success {
            border-left-color: #28a745;
            color: #28a745;
        }
        .warning {
            border-left-color: #ffc107;
            color: #856404;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        h2 {
            margin-top: 0;
        }
        input, select {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ ìˆ˜ì • ê¸°ëŠ¥ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>1. í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±</h2>
            <button class="btn-primary" onclick="createTestData()">í…ŒìŠ¤íŠ¸ ë§¤ë¬¼ ìƒì„±</button>
            <button class="btn-warning" onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
        </div>
        
        <div class="test-section">
            <h2>2. ìˆ˜ì • í…ŒìŠ¤íŠ¸</h2>
            <p>ë§¤ë¬¼ ID: <input type="text" id="propertyId" placeholder="ì˜ˆ: test_1234"></p>
            <button class="btn-success" onclick="testEdit()">ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™ í…ŒìŠ¤íŠ¸</button>
            <button class="btn-primary" onclick="testLoadData()">ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
            <button class="btn-warning" onclick="testSaveData()">ì €ì¥ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <div class="test-section">
            <h2>3. ê²½ë¡œ í…ŒìŠ¤íŠ¸</h2>
            <button class="btn-primary" onclick="testPaths()">ê²½ë¡œ í™•ì¸</button>
            <button class="btn-success" onclick="testNavigation()">í˜ì´ì§€ ì´ë™ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <div class="test-section">
            <h2>4. ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</h2>
            <button class="btn-danger" onclick="runFullTest()">ì „ì²´ CRUD í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        </div>
        
        <div class="log" id="logContainer">
            <div class="log-entry">í…ŒìŠ¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
    </div>

    <script>
        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }
        
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
        function createTestData() {
            log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹œì‘...');
            
            const testProperties = [
                {
                    id: 'test_' + Date.now(),
                    property_number: '20250821_' + Math.floor(Math.random() * 1000),
                    register_date: new Date().toISOString().split('T')[0],
                    property_name: 'í…ŒìŠ¤íŠ¸ ì•„íŒŒíŠ¸ ' + Date.now(),
                    manager: 'í•˜ìƒí˜„',
                    status: 'ê±°ë˜ê°€ëŠ¥',
                    property_type: 'ì•„íŒŒíŠ¸',
                    trade_type: 'ë§¤ë§¤',
                    price: '75000',
                    address: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™',
                    dong: '101',
                    ho: '1501',
                    supply_area_sqm: '84.5',
                    supply_area_pyeong: '25.5',
                    floor_current: '15',
                    floor_total: '20',
                    special_notes: 'ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸ìš© ë§¤ë¬¼',
                    shared: false
                }
            ];
            
            // localStorageì— ì €ì¥
            let existingData = [];
            try {
                const stored = localStorage.getItem('properties');
                if (stored) {
                    existingData = JSON.parse(stored);
                }
            } catch (e) {
                log('ê¸°ì¡´ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜: ' + e.message, 'error');
            }
            
            existingData.push(...testProperties);
            localStorage.setItem('properties', JSON.stringify(existingData));
            
            // window.currentDataì—ë„ ì €ì¥
            window.currentData = existingData;
            
            log(`âœ… í…ŒìŠ¤íŠ¸ ë§¤ë¬¼ ìƒì„± ì™„ë£Œ: ID=${testProperties[0].id}`, 'success');
            document.getElementById('propertyId').value = testProperties[0].id;
            
            return testProperties[0];
        }
        
        // ëª¨ë“  ë°ì´í„° ì‚­ì œ
        function clearAllData() {
            localStorage.removeItem('properties');
            window.currentData = [];
            log('âš ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œë¨', 'warning');
        }
        
        // ìˆ˜ì • í˜ì´ì§€ ì´ë™ í…ŒìŠ¤íŠ¸
        function testEdit() {
            const propertyId = document.getElementById('propertyId').value;
            if (!propertyId) {
                log('ë§¤ë¬¼ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }
            
            log(`ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™ í…ŒìŠ¤íŠ¸: ID=${propertyId}`);
            
            // ê´€ë¦¬ì ëª¨ë“œ ì„¤ì •
            sessionStorage.setItem('admin_logged_in', 'true');
            
            // ê²½ë¡œ ê³„ì‚°
            const basePath = window.location.pathname.includes('/The-realty_hasia/') 
                ? '/The-realty_hasia/' 
                : window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
            
            const editUrl = `${basePath}form.html?id=${propertyId}`;
            log(`ì´ë™í•  URL: ${editUrl}`, 'success');
            
            // ìƒˆ ì°½ì—ì„œ ì—´ê¸°
            window.open(editUrl, '_blank');
        }
        
        // ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸
        function testLoadData() {
            const propertyId = document.getElementById('propertyId').value;
            if (!propertyId) {
                log('ë§¤ë¬¼ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'error');
                return;
            }
            
            log(`ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸: ID=${propertyId}`);
            
            // localStorageì—ì„œ ì°¾ê¸°
            try {
                const stored = localStorage.getItem('properties');
                if (stored) {
                    const properties = JSON.parse(stored);
                    const found = properties.find(p => p.id === propertyId);
                    
                    if (found) {
                        log('âœ… ë§¤ë¬¼ ë°ì´í„° ë°œê²¬:', 'success');
                        log(JSON.stringify(found, null, 2));
                    } else {
                        log(`âŒ ID=${propertyId} ë§¤ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ`, 'error');
                    }
                }
            } catch (e) {
                log('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ' + e.message, 'error');
            }
        }
        
        // ì €ì¥ í…ŒìŠ¤íŠ¸
        function testSaveData() {
            log('ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸...');
            
            // saveProperty í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
            if (typeof window.saveProperty === 'function') {
                log('âœ… saveProperty í•¨ìˆ˜ ì¡´ì¬', 'success');
            } else {
                log('âŒ saveProperty í•¨ìˆ˜ê°€ ì—†ìŒ', 'error');
                
                // ì„ì‹œ saveProperty í•¨ìˆ˜ ìƒì„±
                window.saveProperty = function() {
                    log('ì„ì‹œ saveProperty í•¨ìˆ˜ í˜¸ì¶œë¨', 'warning');
                    alert('ì €ì¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
                };
                log('âš ï¸ ì„ì‹œ saveProperty í•¨ìˆ˜ ìƒì„±ë¨', 'warning');
            }
        }
        
        // ê²½ë¡œ í…ŒìŠ¤íŠ¸
        function testPaths() {
            log('=== ê²½ë¡œ í…ŒìŠ¤íŠ¸ ===');
            log(`í˜„ì¬ URL: ${window.location.href}`);
            log(`pathname: ${window.location.pathname}`);
            
            const isGitHubPages = window.location.pathname.includes('/The-realty_hasia/');
            log(`GitHub Pages í™˜ê²½: ${isGitHubPages ? 'YES' : 'NO'}`);
            
            const basePath = isGitHubPages 
                ? '/The-realty_hasia/' 
                : window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
            
            log(`ê³„ì‚°ëœ ê¸°ë³¸ ê²½ë¡œ: ${basePath}`, 'success');
            log(`index.html ê²½ë¡œ: ${basePath}index.html`);
            log(`form.html ê²½ë¡œ: ${basePath}form.html`);
        }
        
        // í˜ì´ì§€ ì´ë™ í…ŒìŠ¤íŠ¸
        function testNavigation() {
            log('í˜ì´ì§€ ì´ë™ í…ŒìŠ¤íŠ¸...');
            
            const basePath = window.location.pathname.includes('/The-realty_hasia/') 
                ? '/The-realty_hasia/' 
                : window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
            
            const testUrls = [
                basePath + 'index.html',
                basePath + 'form.html',
                basePath + 'form.html?id=test123'
            ];
            
            testUrls.forEach(url => {
                log(`í…ŒìŠ¤íŠ¸ URL: ${url}`);
                // ì‹¤ì œë¡œ ì´ë™í•˜ì§€ ì•Šê³  URLë§Œ ê²€ì¦
                try {
                    new URL(url, window.location.origin);
                    log(`âœ… ìœ íš¨í•œ URL`, 'success');
                } catch (e) {
                    log(`âŒ ì˜ëª»ëœ URL: ${e.message}`, 'error');
                }
            });
        }
        
        // ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
        async function runFullTest() {
            log('=== ì „ì²´ CRUD í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'warning');
            
            // 1. í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            log('1ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±');
            const testData = createTestData();
            await sleep(1000);
            
            // 2. ë°ì´í„° ë¡œë“œ í™•ì¸
            log('2ë‹¨ê³„: ë°ì´í„° ë¡œë“œ í™•ì¸');
            testLoadData();
            await sleep(1000);
            
            // 3. ìˆ˜ì • í˜ì´ì§€ ì´ë™ ê°€ëŠ¥ í™•ì¸
            log('3ë‹¨ê³„: ìˆ˜ì • í˜ì´ì§€ ê²½ë¡œ í™•ì¸');
            testPaths();
            await sleep(1000);
            
            // 4. ì €ì¥ í•¨ìˆ˜ í™•ì¸
            log('4ë‹¨ê³„: ì €ì¥ í•¨ìˆ˜ í™•ì¸');
            testSaveData();
            await sleep(1000);
            
            log('=== í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===', 'success');
            log('âœ… ìƒì„±ëœ í…ŒìŠ¤íŠ¸ ë§¤ë¬¼ ID: ' + testData.id, 'success');
            log('âœ… ì´ì œ "ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™ í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìˆ˜ì • ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”', 'success');
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            log('ë””ë²„ê·¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            
            // ê¸°ì¡´ ë°ì´í„° í™•ì¸
            try {
                const stored = localStorage.getItem('properties');
                if (stored) {
                    const properties = JSON.parse(stored);
                    log(`ê¸°ì¡´ ë§¤ë¬¼ ${properties.length}ê°œ ë°œê²¬`, 'warning');
                    if (properties.length > 0) {
                        document.getElementById('propertyId').value = properties[0].id;
                    }
                }
            } catch (e) {
                log('ê¸°ì¡´ ë°ì´í„° í™•ì¸ ì‹¤íŒ¨', 'error');
            }
        });
    </script>
</body>
</html>